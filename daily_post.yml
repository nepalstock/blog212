permissions:
  contents: write

steps:
  - name: Checkout code
    uses: actions/checkout@v3
  
  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.9'

  - name: Install dependencies
    run: pip install -r requirements.txt

  - name: Run Script
    env:
      # --- AUTHENTICATION SECRETS ---
      SERVICE_ACCOUNT_JSON: ${{ secrets.SERVICE_ACCOUNT_JSON }} 
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} 
    run: python auto_blogger.py
    
  - name: Commit and Push DB changes
    run: |
      git config --global user.name 'GitHub Action'
      git config --global user.email 'action@github.com'
      git add posted_ids.json
      git diff --quiet && git diff --staged --quiet || (git commit -m "Update posted IDs" && git push)
